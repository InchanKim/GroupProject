---
title: "internToEmployee"
author: "Thompson"
date: "April 20, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F)

library(tidyverse)
library(DBI)
library(lubridate)
library(scales)
library(knitr)
library(ggplot2)

source("conn.R")
```

```{r}
graduation <- tbl(conStudent, 'graduation') %>%
  filter(degreeLevel == "Bachelor") %>% collect() # Only uses undergrad students
internship <- tbl(conStudent, 'internship') %>% collect()
organization <- tbl(conStudent, 'organization') %>% collect()
currPosition <- tbl(conStudent, 'currentPosition') %>% collect()
suppressWarnings(fulltime <- tbl(conStudent, 'fulltime') %>% collect())
employment <- tbl(conStudent, 'employment') %>% collect()

internGrad <- right_join(internship, graduation, by = 'graduationId') %>%
  select(graduationId, internshipId) %>%
  mutate(interns = !is.na(internshipId)) %>% 
  count(graduationId, interns) %>% 
  mutate(interns = interns*n) %>% 
  mutate(interns = as.numeric(interns)) %>% 
  select(graduationId, interns) %>% 
  filter(interns != 0, graduationId)

noInternGrad <- right_join(internship, graduation, by = 'graduationId') %>%
  select(graduationId, internshipId, organizationId) %>%  
  filter(is.na(internshipId))
#double check - 0's?

```

#Already Added
Of all of the students graduating from LSU with a Bachelors Degree from 2017, `r percent(length(internGrad$interns)/length(graduation$graduationId))` had internships while completing their degree.
There was a total of `r sum(internGrad$interns)` internships completed from the class of 2017.

#Internship Turnovers

```{r}
graduationTitle <- tbl(conStudent, 'graduationTitle') %>% collect()
title <- tbl(conStudent, 'title') %>% collect()

major <- left_join(graduationTitle, title, by = "idTitle") %>% 
  select(graduationId, majorName, titleCode)

internCurrent <- inner_join(internship, currPosition, by = 'graduationId') %>%
  mutate(organizationId = as.numeric(organizationId.y)) %>% 
  mutate(intOrganizationId = as.numeric(organizationId.x)) %>% 
  left_join(graduation, by = 'graduationId') %>%
  select(internshipId, academicCredit, graduationId, intOrganizationId, organizationId, idCurrentPosition, positionType)

byMajor <- left_join(internCurrent, major, by = 'graduationId')

organizName <- left_join(organization, internCurrent, by = 'organizationId') %>%
  select(organizationId, intOrganizationId, organizationName, graduationId, idCurrentPosition)

stayed <- organizName %>% filter(organizationId == intOrganizationId) %>%
  distinct(graduationId, .keep_all = TRUE)

ftstay <- left_join(stayed, fulltime, by = "idCurrentPosition") %>%
  select(organizationId:salary) %>% distinct(salary) 

## Errors fixed. You were using an object (ordIdStay) that didn't exist
## I replaced it with "stayed"
#  length(stayed$organizationId)/length(noInternGrad$graduationId)
# Not sure what you wanted to do with this, but right now it's just a random output

noInt <- length(graduation$graduationId) - length(stayed$organizationId)
# the length for noInternGrad$graduationId and this difference should equal up
# they are about 4000 apart

#noIntSalTotal <- sum(fulltime$salary, na.rm = TRUE) - sum(ftOI, na.rm = TRUE) 
#noIntSalTotal/length(noInternGrad$graduationId) 
## "ftOI" doesn't exist, I'm not sure what you were trying to use here

#nIntFT <- left_join(noInternGrad, employment, by = "organizationId") = was trying to see the employment total of those without internships but without the values to match, idk if it'll work

```

Of those who interned for a company, `r length(stayed$organizationId)` graduates continued to work with that same company upon graduation, which is `r  percent(length(stayed$organizationId)/length(fulltime$idCurrentPosition))` of those hired full time.

As a whole, these graduates who continued to work with their internship company make a starting average salary of about `r # dollar(sum(ftOI, na.rm = TRUE)/length(ftOI$salary))`.

The overall full-time average is `r dollar(sum(fulltime$salary, na.rm = TRUE)/length(fulltime$salary))`, so those who had an internship and marked down their salary made `r # percent((sum(ftOI, na.rm = TRUE)/length(ftOI$salary))/(sum(fulltime$salary, na.rm = TRUE)/length(fulltime$salary)))` the starting salary than the accumulated full-time average across all graduates.

There were `r length(noInternGrad$graduationId)` students who did not have internships, which is about 13 people without an internship for every 1 with an internship. 

#Extra 

```{r}
#trying to get a graph where x = positionType (filtered to certain values), y = count, and fill color in graphs is titleCode for majors



byMajor %>% filter(positionType == 'Continuing education' & positionType == 'Employed full-time' & positionType == 'Seeking employment') %>% 
  ggplot() +
  geom_bar(aes(x = positionType)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```




```{r}

#old but keep until finished my part

xx<- internship %>% 
  left_join(organization) %>%  #fiter to get graduation id - filter to a variable to say yes or no, 
  group_by(organizationId) %>% 
  filter(!is.na(organizationId)) %>% collect() #to drop the NA, use filter with a negate operator

#Ideas to consider
      # 2. if the student had internship --> diff company? (total/internship total) expected med-high
      # 3. if the student did not get hired --> no current position (total/internship total) expected low


```


Left to Do...
- Make Plots 
- Write Graph Summaires
- Compare Data to Isabella's boxplots
   -- The Data on If they stayed 
- Final Breakdown of each segment
- Compare Paid to UnPaid (join dts) - admir/inchan 
- (if possible) try to break down by major 
