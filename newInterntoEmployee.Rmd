
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
conStudent <- src_mysql(host = "ba-isdsclass-programdev.lsu.edu",
                        port = 3306,
                        user = 'student',
                        password = 'student',
                        dbname = "isds_3105")
library(DBI)
library(lubridate)
library(scales)
library(knitr)
library(ggplot2)

source("salaryBrackets.R")
source("conn.R")

```

```{r}

graduation <- tbl(conStudent, 'graduation') %>% collect()
internship <- tbl(conStudent, 'internship') %>% collect()
organization <- tbl(conStudent, 'organization') %>% collect()
currPosition <- tbl(conStudent, 'currentPosition') %>% collect()
fulltime <- tbl(conStudent, 'fulltime') %>% collect() 
employment <- tbl(conStudent, 'employment') %>% collect()

#n: shows students who had internships and the number they had
internGrad <- right_join(internship, graduation, by = c('graduationId', 'graduationId')) %>% select(graduationId, internshipId, idCollege) %>% mutate(interns = !is.na(internshipId)) %>% count(graduationId, interns, idCollege) %>% mutate(interns = interns*n) %>% mutate(interns = as.numeric(interns)) %>% select(graduationId, interns, idCollege) %>% filter(interns != 0, graduationId)


internGrad %>% group_by(idCollege, interns) %>% summarise(nc = n()) %>% 
  ggplot() +
  geom_col(aes(x = idCollege, y = nc, group = interns), position = 'dodge') +
  ggtitle("Graduate Internships", "Number Completed in Individual College Career")
#adjust axis titles, fix coloring, figure out other cool things to add

```

#Already Added
Of all of the LSU graduates from 2017, `'r percent(length(internGrad$interns)/length(graduation$graduationId))` had internships while completing their degree.
There was a total of `r sum(internGrad$interns)` internships completed from the class of 2017.

#Internship Turnovers

```{r}
graduationTitle <- tbl(conStudent, 'graduationTitle') %>% collect()
title <- tbl(conStudent, 'title') %>% collect()

#this is shows the major for each graduationId
major <- left_join(graduationTitle, title, by = "idTitle") %>% select(graduationId, majorName, titleCode)
#this allows the comparison of organizationIds to see who stayed with their company
internCurrent <- inner_join(internship, currPosition, by = c('graduationId')) %>% mutate(organizationId = as.numeric(organizationId.y)) %>% mutate(intOrganizationId = as.numeric(organizationId.x)) %>% select(internshipId, academicCredit, graduationId, intOrganizationId, organizationId, idCurrentPosition, positionType)

#those two combined with a column d that shows if they stayed or left
byMajor <- left_join(internCurrent, major, by = 'graduationId')%>% distinct(graduationId, .keep_all = TRUE) %>% mutate(nOrs = if_else(condition = intOrganizationId == organizationId, true = "Same Company", false = "New Company")) %>% select(graduationId, internshipId, intOrganizationId, organizationId, nOrs, positionType, majorName, titleCode, idCurrentPosition, academicCredit) %>% filter(!is.na(nOrs))

#q: I think the nas are significant becuase they account for all of those who may be continuing education or are not employed, etc. - is there a way to show those features on this?
co <- ggplot(byMajor) +
  geom_bar(aes(x = nOrs)) 
#n: add colors, titles, etc. 
co  

#for salary overviews 
stayed <- byMajor %>% filter(d == 'Same Company') 
newco <- byMajor %>% filter(d == 'New Company')
ftstay <- left_join(stayed, fulltime, by = "idCurrentPosition") %>% select(salary) %>% filter(salary > 1)
ftnew <- left_join(newco, fulltime, by = "idCurrentPosition") %>% select(salary) %>% filter(salary > 6)
ftTotSalary <- fulltime %>% select(salary) %>% filter(salary > 6) 

salCo <- left_join(byMajor, yy, by = 'graduationId') %>%
  filter(!is.na(salaryBracket)) %>% 
  select(salaryBracket, nOrs) %>% count(salaryBracket, nOrs)
  
salCo %>% ggplot() +
  geom_col(aes(x = nOrs, y = n, fill = salaryBracket), position = 'dodge') +
  ggtitle("Salary for Full Time", "New Company vs Same Company")


```

Of those who interned for a company, `r length(stayed$organizationId)` graduates continued to work with that same company upon graduation, which is `r  percent(length(stayed$organizationId)/length(fulltime$idCurrentPosition))` of those hired full time.

Of those who interned for a company, `r length(newco$organizationId)` graduates started a position at a new company upon graduation, which is `r  percent(length(newco$organizationId)/length(fulltime$idCurrentPosition))` of those hired full time.

With the removal of outliers - Of the `r length(ftTotSalary$salary)` students who submitted their salary for full-time positions, we found that graduates...
- the `r length(ftstay$salary)` who continued to work for the same internship company made:
  + in total `r dollar(sum(ftstay))`, which is `r percent(sum(ftstay)/sum(ftTotSalary))` of total full time
  + on average `r dollar(sum(ftstay)/length(ftstay$salary))`
- the `r length(ftnew$salary)` who started a position at a new company made:
  + in total `r dollar(sum(ftnew))`, which is  `r percent(sum(ftnew)/sum(ftTotSalary))` of total full time
  + on average `r dollar(sum(ftnew)/length(ftnew$salary))`
 
 

##where I stopped @2pm - come back and finish from here.
As a whole, these graduates who continued to work with their internship company make a starting average salary of about `r dollar(sum(ftstay, na.rm = TRUE)/length(f$salary))`.

The overall full-time average is `r dollar(sum(fulltime$salary, na.rm = TRUE)/length(fulltime$salary))`, so those who had an internship and marked down their salary made `r percent((sum(ftOI, na.rm = TRUE)/length(ftOI$salary))/(sum(fulltime$salary, na.rm = TRUE)/length(fulltime$salary)))` the starting salary than the accumulated full-time average across all graduates.


```{r}



```


#Extra 

```{r}
#trying to get a graph where x = positionType (filtered to certain values), y = count, and fill color in graphs is titleCode for majors

#shows students who did not have internships
noInternGrad <- right_join(internship, graduation, by = c('graduationId', 'graduationId')) %>% select(graduationId, internshipId, organizationId) %>%  filter(is.na(internshipId)) 
#double check - 0's? come back - maybe try to see if you can just subtract the sum of internGrad$interns from total

byMajor %>% filter(positionType == 'Continuing education' & positionType == 'Employed full-time' & positionType == 'Seeking employment') %>% 
  ggplot() +
  geom_bar(aes(x = positionType)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#old no internship code with errors....
length(orgIdStay$organizationId)/length(noInternGrad$graduationId)
noInt <- length(graduation$graduationId) - length(orgIdStay$organizationId) # the length for noIntern and this difference should equal up - they are about 4000 apart

noIntSalTotal <- sum(fulltime$salary, na.rm = TRUE) - sum(ftOI, na.rm = TRUE) 
noIntSalTotal/length(noInternGrad$graduationId) #doesn't seem right - need to double check

#nIntFT <- left_join(noInternGrad, employment, by = "organizationId") = was trying to see the employment total of those without internships but without the values to match, idk if it'll work
```

There were `r length(noInternGrad$graduationId)` students who did not have internships, which is about 13 people without an internship for every 1 with an internship. 



```{r}
#filters out position type by fulll time for na's
byMajorcopy <- left_join(internCurrent, major, by = 'graduationId')%>% distinct(graduationId, .keep_all = TRUE) %>% mutate(d = if_else(condition = intOrganizationId == organizationId, true = "Same Company", false = "New Company")) %>% select(graduationId, internshipId, intOrganizationId, organizationId, d, positionType, majorName, titleCode, idCurrentPosition, academicCredit) %>% filter(positionType == 'Employed full-time')

#old but keep until finished my part

xx<- internship %>% 
  left_join(organization) %>%  #fiter to get graduation id - filter to a variable to say yes or no, 
  group_by(organizationId) %>% 
  filter(!is.na(organizationId)) %>% collect() #to drop the NA, use filter with a negate operator

#Ideas to consider
      # 2. if the student had internship --> diff company? (total/internship total) expected med-high
      # 3. if the student did not get hired --> no current position (total/internship total) expected low


```


Left to Do...
- Make Plots 
- Write Graph Summaires
- Compare Data to Isabella's boxplots
   -- The Data on If they stayed 
- Final Breakdown of each segment
- Compare Paid to UnPaid (join dts) - admir/inchan 
- (if possible) try to break down by major 



=======

---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
conStudent <- src_mysql(host = "ba-isdsclass-programdev.lsu.edu",
                        port = 3306,
                        user = 'student',
                        password = 'student',
                        dbname = "isds_3105")
library(DBI)
library(lubridate)
library(scales)
library(knitr)
library(ggplot2)

source("conn.R")

```

```{r}

graduation <- tbl(conStudent, 'graduation') %>% collect()
internship <- tbl(conStudent, 'internship') %>% collect()
organization <- tbl(conStudent, 'organization') %>% collect()
currPosition <- tbl(conStudent, 'currentPosition') %>% collect()
fulltime <- tbl(conStudent, 'fulltime') %>% collect() 
employment <- tbl(conStudent, 'employment') %>% collect()

#n: shows students who had internships and the number they had
internGrad <- right_join(internship, graduation, by = c('graduationId', 'graduationId')) %>% select(graduationId, internshipId, idCollege) %>% mutate(interns = !is.na(internshipId)) %>% count(graduationId, interns, idCollege) %>% mutate(interns = interns*n) %>% mutate(interns = as.numeric(interns)) %>% select(graduationId, interns, idCollege) %>% filter(interns != 0, graduationId)

#q: is there a way to get it to show by college in 1 graph with counting 1,2,3,4 for each?
internGrad %>% group_by(interns) %>% summarise(nc = n()) %>% 
  ggplot() +
  geom_col(aes(x = interns, y = nc), fill = 'purple') +
  ggtitle("Graduate Internships", "Number Completed in Individual College Career")
#adjust axis titles, fix coloring, figure out other cool things to add



```

#Already Added
Of all of the LSU graduates from 2017, `'r percent(length(internGrad$interns)/length(graduation$graduationId))` had internships while completing their degree.
There was a total of `r sum(internGrad$interns)` internships completed from the class of 2017.

#Internship Turnovers

```{r}
graduationTitle <- tbl(conStudent, 'graduationTitle') %>% collect()
title <- tbl(conStudent, 'title') %>% collect()

#this is shows the major for each graduationId
major <- left_join(graduationTitle, title, by = "idTitle") %>% select(graduationId, majorName, titleCode)
#this allows the comparison of organizationIds to see who stayed with their company
internCurrent <- inner_join(internship, currPosition, by = c('graduationId')) %>% mutate(organizationId = as.numeric(organizationId.y)) %>% mutate(intOrganizationId = as.numeric(organizationId.x)) %>% select(internshipId, academicCredit, graduationId, intOrganizationId, organizationId, idCurrentPosition, positionType)

#those two combined with a column d that shows if they stayed or left
byMajor <- left_join(internCurrent, major, by = 'graduationId')%>% distinct(graduationId, .keep_all = TRUE) %>% mutate(d = if_else(condition = intOrganizationId == organizationId, true = "Same Company", false = "New Company")) %>% select(graduationId, internshipId, intOrganizationId, organizationId, d, positionType, majorName, titleCode, idCurrentPosition, academicCredit)

#q: I think the nas are significant becuase they account for all of those who may be continuing education or are not employed, etc. - is there a way to show those features on this?
co <- ggplot(byMajor) +
  geom_bar(aes(x = d)) 
#n: add colors, titles, etc. 
co  

#for salary overviews 
stayed <- byMajor %>% filter(d == 'Same Company') 
newco <- byMajor %>% filter(d == 'New Company')
ftstay <- left_join(stayed, fulltime, by = "idCurrentPosition") %>% select(salary) %>% filter(salary > 1)
ftnew <- left_join(newco, fulltime, by = "idCurrentPosition") %>% select(salary) %>% filter(salary > 6)
ftTotSalary <- fulltime %>% select(salary) %>% filter(salary > 6) 

```

Of those who interned for a company, `r length(stayed$organizationId)` graduates continued to work with that same company upon graduation, which is `r  percent(length(stayed$organizationId)/length(fulltime$idCurrentPosition))` of those hired full time.

Of those who interned for a company, `r length(newco$organizationId)` graduates started a position at a new company upon graduation, which is `r  percent(length(newco$organizationId)/length(fulltime$idCurrentPosition))` of those hired full time.

With the removal of outliers - Of the `r length(ftTotSalary$salary)` students who submitted their salary for full-time positions, we found that graduates...
- the `r length(ftstay$salary)` who continued to work for the same internship company made:
  + in total `r dollar(sum(ftstay))`, which is `r percent(sum(ftstay)/sum(ftTotSalary))` of total full time
  + on average `r dollar(sum(ftstay)/length(ftstay$salary))`
- the `r length(ftnew$salary)` who started a position at a new company made:
  + in total `r dollar(sum(ftnew))`, which is  `r percent(sum(ftnew)/sum(ftTotSalary))` of total full time
  + on average `r dollar(sum(ftnew)/length(ftnew$salary))`
 
 

##where I stopped @2pm - come back and finish from here.
As a whole, these graduates who continued to work with their internship company make a starting average salary of about `r dollar(sum(ftstay, na.rm = TRUE)/length(f$salary))`.

The overall full-time average is `r dollar(sum(fulltime$salary, na.rm = TRUE)/length(fulltime$salary))`, so those who had an internship and marked down their salary made `r percent((sum(ftOI, na.rm = TRUE)/length(ftOI$salary))/(sum(fulltime$salary, na.rm = TRUE)/length(fulltime$salary)))` the starting salary than the accumulated full-time average across all graduates.


```{r}



```


#Extra 

```{r}
#trying to get a graph where x = positionType (filtered to certain values), y = count, and fill color in graphs is titleCode for majors

#shows students who did not have internships
noInternGrad <- right_join(internship, graduation, by = c('graduationId', 'graduationId')) %>% select(graduationId, internshipId, organizationId) %>%  filter(is.na(internshipId)) 
#double check - 0's? come back - maybe try to see if you can just subtract the sum of internGrad$interns from total

byMajor %>% filter(positionType == 'Continuing education' & positionType == 'Employed full-time' & positionType == 'Seeking employment') %>% 
  ggplot() +
  geom_bar(aes(x = positionType)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#old no internship code with errors....
length(orgIdStay$organizationId)/length(noInternGrad$graduationId)
noInt <- length(graduation$graduationId) - length(orgIdStay$organizationId) # the length for noIntern and this difference should equal up - they are about 4000 apart

noIntSalTotal <- sum(fulltime$salary, na.rm = TRUE) - sum(ftOI, na.rm = TRUE) 
noIntSalTotal/length(noInternGrad$graduationId) #doesn't seem right - need to double check

#nIntFT <- left_join(noInternGrad, employment, by = "organizationId") = was trying to see the employment total of those without internships but without the values to match, idk if it'll work
```

There were `r length(noInternGrad$graduationId)` students who did not have internships, which is about 13 people without an internship for every 1 with an internship. 



```{r}

#old but keep until finished my part

xx<- internship %>% 
  left_join(organization) %>%  #fiter to get graduation id - filter to a variable to say yes or no, 
  group_by(organizationId) %>% 
  filter(!is.na(organizationId)) %>% collect() #to drop the NA, use filter with a negate operator

#Ideas to consider
      # 2. if the student had internship --> diff company? (total/internship total) expected med-high
      # 3. if the student did not get hired --> no current position (total/internship total) expected low


```


Left to Do...
- Make Plots 
- Write Graph Summaires
- Compare Data to Isabella's boxplots
   -- The Data on If they stayed 
- Final Breakdown of each segment
- Compare Paid to UnPaid (join dts) - admir/inchan 
- (if possible) try to break down by major 

